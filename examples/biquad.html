<!DOCTYPE html>
<html>
  <head>
    <!-- Load JQuery and JQuery-UI -->
    <link type="text/css" href="css/hot-sneaks/jquery-ui-1.8.custom.css" rel="stylesheet" />  
    <script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.custom.min.js"></script>
    
    <!-- Load Processing.js -->
    <script language="javascript" src="js/processing.js"></script>
    <script language="javascript" src="js/init.js"></script>

    <!-- Load DSP.js -->
    <script src="../dsp.js"></script>
    <script>
      $(function() {
        $('#freq').slider({ orientation: 'vertical', range: 'min', min: 60, max: 10000, step: 1, value: 880, slide: changeF0 });
        $('#q').slider({ orientation: 'vertical', range: 'min', min: 0.0, max: 1.0, value: 1.0, step: 0.001, slide: changeQ });
        $('#bw').slider({ orientation: 'vertical', range: 'min', min: 1.0, max: 10.0, value: 1.0, step: 0.001, slide: changeBW });
        $('#s').slider({ orientation: 'vertical', range: 'min', min: 0.0, max: 1.0, value: 1.0, step: 0.001, slide: changeS });
      });
    </script>

    <style type="text/css">
      body, * {
        font-family: Arial, sans-serif;
      }
      .control {
        padding: 5px;
        border: 1px outset #CCC;
        background-color: #EEE;
        float: left;
        margin-right: 5px;
      }
      .control table td {
        padding: 10px;
        width: 20px;
        color: #999;
        font-size: 12px;
      }
      .control h3 {
        margin: 0;
        padding:0;
        font-size: 12px;
        margin-bottom: 10px;
      }
      .control #debug {
        border: 1px inset #ccc;
        background-color: #FFF;
        font-size: 12px;
        width: 300px;
        padding: 10px;
      }
      .slider {
        margin-bottom: 16px;
        width: 8px;
      }
      
      .ui-slider .ui-slider-handle {
        width: 8px;
        margin-left: 3px;
      }
    </style>
  </head>
  <body>
    <script>
      // Setup shared variables
      var sampleRate = 44100;
      
      var response = [];
      var biquad;

      var plotCoeffs = function() {
	var b = [biquad.b0, biquad.b1, biquad.b2];
	var a = [biquad.a0, biquad.a1, biquad.a2];
	
	response = DSP.mag2db(DSP.freqz(b, a));
      }

      var changeF0 = function() {
	biquad.setF0($('#freq').slider('option', 'value'));
	plotCoeffs();
      }
    
      var changeBW = function() {
	biquad.setBW($('#bw').slider('option', 'value'));
	plotCoeffs();
      }

      var changeS = function() {
	biquad.setS($('#s').slider('option', 'value'));
	plotCoeffs();
      }

      var changeQ = function() {
        biquad.setQ($('#q').slider('option', 'value'));
	plotCoeffs();
      }
    </script>
    
    <script type="application/processing" target="#signal">
      void setup() {
        size(512, 200);
        biquad = new Biquad(DSP.BPF_CONSTANT_SKIRT, sampleRate);
        changeF0();
	changeQ();

        stroke(255);
        strokeWeight(1);
        frameRate(20);
      }
      
      void draw() {
        background(255);

	// Draw axes
	float yMin = -120;
	float yMax = 120;
	float yCenter = 0;
	
	float xMin = -PI;
	float xMax = PI;
	float xCenter = 0;

	stroke(0);
	line(map(xCenter, xMin, xMax, 0, width), map(yMin, yMin, yMax, height, 0), map(xCenter, xMin, xMax, 0, width), map(yMax, yMin, yMax, height, 0)); 
	line(map(xMin, xMin, xMax, 0, width), map(yCenter, yMin, yMax, height, 0), map(xMax, xMin, xMax, 0, width), map(yCenter, yMin, yMax, height, 0)); 
      
	// Draw the response
	noFill();
	stroke(10, 40, 200);
	beginShape();
        for (int i = 0; i < response.length; i++) {
          vertex(map(i, 0, response.length, 0, width), map(response[i], yMin, yMax, height, 0));
        }
	endShape();
      }
    </script>
    
    <h1>Audio Filter</h1>
    <p>Applies a Low pass filter to an audio stream. Remember to <b>Mute</b> the audio to hear the pure filtered sound.</p>
    <p>The low pass filter acts as a gate, only letting frequencies below the cut off value through.</p> 
    
    <p>The <b>F</b> slider controls the cut off frequency, between 0 and 22050 Hz.</p>
    <p>The <b>Q</b>
    slider controls the resonance drive.</p>
    <p>A low frequency cutoff and strong resonance can give an acidy or dampened underwater effect.</p>
    <p>(Be careful! Adjust your volume! Certain slider combinations can give off loud undesired schreeching noises!)</p>
    <p>Music: Delv-X: Megaman theme (cover)</p>
    <audio id='input' tabindex="0" src="audio/megaman.ogg" controls="true" onaudiowritten="audioWritten(event);" style="width: 512px;"></audio><br>

    <div style="width: 620px;">
      <div><canvas id="signal" width="512px" height="200px" style="float: left;"></canvas></div>
      
      <div class="control" style="float: right; height: 188px">
        <h3>Low Pass Filter</h3>
        <table>
          <tr>
            <td><div id="freq" class="slider"></div>freq</td>
            <td><div id="q" class="slider"></div>Q</td>
            <td><div id="bw" class="slider"></div>BW</td>
            <td><div id="s" class="slider"></div>S</td>
          </tr>
        </table>
      </div>
    </div>
  </body>
</html>
